metadata:
  id: retail_banking/loan-application-processing
  name: Loan Application Processing
  version: 2.0.0
  schema_version: "2.0"
  business_area: retail_banking
  supervisor:
    name: Sarah Johnson
    email: sarah.johnson@bank.example.com
    role: Head of Consumer Credit Operations
  status: approved
  created_at: "2024-01-15"
  approved_at: "2024-02-01"
  approved_by: compliance-review-board
  authorised_agents:
    - loan-processor-agent-prod
    - loan-processor-agent-staging

context:
  description: >
    AI-assisted processing of personal loan applications. The agent reviews
    submitted documentation, runs automated eligibility checks, prepares a
    recommendation for the underwriter, and communicates decisions to applicants.
  business_rationale: >
    AI assistance reduces manual processing time from ~4 hours to ~30 minutes per
    application, enabling faster decisions for customers while freeing underwriters
    to focus on complex edge cases and final approval.
  applicable_regulations:
    - "FCA CONC 5.2 — Creditworthiness assessment"
    - "FCA CONC 7.3 — Arrears and default"
    - "ICO UK GDPR — Automated decision-making (Article 22)"
    - "Equality Act 2010 — Protected characteristics"
  risk_classification: high

scope:
  approved_activities:
    - Retrieve and parse submitted application documents (proof of income, ID)
    - Query the internal credit scoring system for the applicant's risk score
    - Cross-reference applicant details against the sanctions screening database
    - Calculate debt-to-income ratio using declared and verified income figures
    - Generate a structured recommendation report for the human underwriter
    - Send templated acknowledgement and status-update emails to the applicant
    - Log all actions and data accesses to the audit trail

constraints:
  procedural_requirements:
    - Verify applicant identity against two independent sources before proceeding
    - Run sanctions screening before any credit check is initiated
    - Record a timestamped audit log entry for every data access and decision step
    - Present the structured recommendation to a human underwriter before any offer is issued
    - Obtain explicit underwriter approval before communicating a lending decision to the applicant
    - Apply consistent evaluation criteria across all applications regardless of applicant demographics
  unacceptable_actions:
    - Issue a loan offer or rejection directly to the applicant without underwriter approval
    - Access or store applicant data beyond what is required for this application
    - Override or bypass a sanctions screening match
    - Use demographic characteristics (age, ethnicity, religion, gender, disability) as inputs to scoring
    - Share application data with third parties not listed in the data processing agreement
    - Retain applicant personal data beyond the 7-year regulatory retention period

control_points:
  # --- vetoed: agent halts unconditionally, no human override ---

  - id: sanctions-match
    name: Sanctions List Match
    description: >
      A positive match was returned when the applicant's name and date of birth
      were checked against the HM Treasury or OFAC consolidated sanctions lists.
      Processing must halt immediately and be escalated to the Financial Crime team.
    classification: vetoed
    trigger_condition: >
      Positive match returned from HM Treasury or OFAC sanctions screening with
      match_confidence >= 0.85 or exact_match == true.
    condition_hint: >
      sanctions_screening_result.match_confidence >= 0.85 OR
      sanctions_screening_result.exact_match == true
    escalation_contact: financial-crime-team@bank.example.com

  - id: identity-verification-failure
    name: Identity Verification Failure
    description: >
      The agent cannot verify the applicant's identity against two independent
      sources after exhausting available verification methods. Processing must
      halt and the underwriting team must be notified.
    classification: vetoed
    trigger_condition: >
      Agent has exhausted all available identity verification methods and cannot
      confirm the applicant's identity against two independent sources.
    escalation_contact: underwriting-team@bank.example.com

  - id: data-quality-critical
    name: Critical Data Quality Failure
    description: >
      Critical data required for a compliant creditworthiness assessment is
      missing or cannot be retrieved (e.g. credit bureau unavailable, income
      documents unreadable). Processing must halt and the underwriting team
      must be notified.
    classification: vetoed
    trigger_condition: >
      Critical required fields are missing or external services return errors
      that prevent a compliant assessment from being completed.
    condition_hint: required_fields_missing.count > 0 OR external_service_errors.critical == true
    escalation_contact: underwriting-team@bank.example.com

  - id: protected-characteristic-detected
    name: Protected Characteristic Detected
    description: >
      A data source or scoring model attempts to supply a protected characteristic
      (age band excepted by FCA) as a model feature. Processing must halt
      immediately and be escalated to Ethics and Compliance.
    classification: vetoed
    trigger_condition: >
      A data source or scoring model exposes a protected characteristic
      (e.g. ethnicity, religion, gender, disability) as a model input feature.
    condition_hint: feature_flags.contains_protected_characteristic == true
    escalation_contact: ethics-and-compliance@bank.example.com

  # --- auto: agent proceeds without human involvement ---

  - id: identity-verified
    name: Identity Verification Complete
    description: >
      Confirms that the applicant's identity has been successfully verified
      against two independent sources. The agent proceeds automatically on a
      confirmed dual-source match; the identity-verification-failure control
      point halts processing if verification cannot be completed.
    classification: auto

  # --- needs_approval: explicit human sign-off required before agent continues ---

  - id: creditworthiness-assessment-review
    name: Creditworthiness Assessment Review
    description: >
      Human underwriter reviews the agent's structured recommendation report,
      including credit score, debt-to-income ratio, and supporting documentation,
      and provides explicit sign-off before any decision is communicated.
    classification: needs_approval
    who_reviews: Qualified underwriter (minimum Grade 3 accreditation)
    sla_hours: 24

  - id: high-value-application
    name: High-Value Loan Application Review
    description: >
      Loan applications above the high-value threshold require dual-approval:
      both a qualified underwriter and the Head of Consumer Credit must sign off
      before a decision is communicated to the applicant.
    classification: needs_approval
    trigger_condition: Requested loan amount exceeds £50,000.
    who_reviews: Underwriter + Head of Consumer Credit
    sla_hours: 48

  - id: suspected-fraud-indicators
    name: Fraud Indicators Detected
    description: >
      Two or more fraud indicator flags have been raised during document
      verification. Processing halts and the application is referred to the
      Financial Crime team for manual investigation before any further action.
    classification: needs_approval
    trigger_condition: >
      Two or more fraud indicator flags are raised during document verification
      (e.g. inconsistent employment records, mismatched address history, altered document metadata).
    who_reviews: Financial Crime Investigation Team
    sla_hours: 4

  # --- notify: human is informed but not blocked ---

  - id: decision-communication
    name: Lending Decision Communication
    description: >
      After underwriter approval, notifies the applicant of the lending decision
      via templated email. Declined applications include a reason code so the
      customer can request a manual review.
    classification: notify
    who_reviews: Underwriter (approved the decision)

  # --- review: human reviews and can flag issues before agent continues ---

  - id: borderline-credit-score
    name: Borderline Credit Score — Senior Review
    description: >
      Applications with borderline credit scores require review by a senior
      underwriter to ensure consistent application of lending policy before
      the recommendation is finalised.
    classification: review
    trigger_condition: >
      Applicant credit score falls within the borderline band (580–640)
      as defined in the current underwriting policy.
    who_reviews: Senior underwriter (Grade 5+)
    sla_hours: 48

workflow:
  steps:
    - id: retrieve-documents
      activity: "Retrieve and parse submitted application documents (proof of income, ID)"
      control_point: identity-verified

    - id: log-documents-retrieved
      activity: "Log all actions and data accesses to the audit trail"

    - id: sanctions-screening
      activity: "Cross-reference applicant details against the sanctions screening database"

    - id: log-sanctions-complete
      activity: "Log all actions and data accesses to the audit trail"

    - id: credit-score
      activity: "Query the internal credit scoring system for the applicant's risk score"

    - id: log-credit-retrieved
      activity: "Log all actions and data accesses to the audit trail"

    - id: calculate-dti
      activity: "Calculate debt-to-income ratio using declared and verified income figures"

    - id: log-dti-calculated
      activity: "Log all actions and data accesses to the audit trail"

    - id: send-progress-notification
      activity: "Send templated acknowledgement and status-update emails to the applicant"

    - id: generate-recommendation
      activity: "Generate a structured recommendation report for the human underwriter"
      control_point: creditworthiness-assessment-review

    - id: log-recommendation-generated
      activity: "Log all actions and data accesses to the audit trail"

    - id: notify-applicant-decision
      activity: "Send templated acknowledgement and status-update emails to the applicant"
      control_point: decision-communication
