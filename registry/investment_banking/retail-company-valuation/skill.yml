metadata:
  id: investment_banking/retail-company-valuation
  name: Retail Company Valuation Model
  version: 2.0.0
  schema_version: "2.0"
  business_area: investment_banking
  type: standard
  supervisor:
    name: Your Full Name
    email: your.name@bank.example.com
    role: Head of Investment Banking Coverage — Retail
  status: draft
  created_at: "2026-02-23"
  approved_at: null
  approved_by: null
  authorised_agents:
    - ib-valuation-agent-prod

context:
  description: >
    AI-assisted construction of valuation models for publicly listed and
    private retail sector companies. The agent assembles comparable company
    analysis (comps), discounted cash flow (DCF) inputs, and LBO model
    parameters from internal and approved external data sources.
  business_rationale: >
    Reduces analyst time spent on data gathering and model setup from ~2 days
    to ~3 hours, allowing coverage teams to focus on judgement-intensive work
    such as assumption review and client presentation.
  applicable_regulations:
    - "FCA MAR — Market Abuse Regulation (insider information controls)"
    - "FCA COBS 12.2 — Research independence requirements"
    - "MiFID II — Conflicts of interest and research objectivity"
  risk_classification: high

scope:
  approved_activities:
    - id: restricted-list-check
      description: Check the target company against the firm's restricted and watch lists prior to any data retrieval
    - id: retrieve-public-filings
      description: Retrieve public financial filings (10-K, 20-F, annual reports) for target and comparable companies
    - id: pull-market-data
      description: Pull approved market data feeds for share price, EV, and trading multiples
    - id: calculate-trading-multiples
      description: Calculate EV/EBITDA, P/E, EV/Sales, and EV/EBIT multiples for comparable companies
    - id: build-dcf-inputs
      description: Build DCF model inputs using normalised historical financials and published consensus forecasts
    - id: construct-lbo-skeleton
      description: Construct LBO model skeleton with standard leverage assumptions
    - id: flag-data-anomalies
      description: Flag data gaps or anomalies in source financials for analyst follow-up
    - id: generate-valuation-report
      description: Generate a structured valuation summary report for senior banker review
    - id: deliver-model
      description: Package and deliver the approved valuation model to authorised recipients
    - id: audit-log
      description: Log all data sources, versions, and assumptions to the audit trail

constraints:
  procedural_requirements:
    - Source all market data exclusively from the approved vendor list
  unacceptable_actions:
    - Use non-public (inside) information as a model input
    - Publish or share the valuation with any external party without Coverage MD approval
    - Override or suppress a flagged data anomaly without analyst acknowledgement
    - Generate a final investment recommendation — the agent produces analysis only
    - Access deal team data rooms for companies outside the approved coverage list

control_points:
  # --- vetoed: agent halts unconditionally, no human override ---

  - id: inside-information-detected
    name: Inside Information Detected
    description: >
      An input data source is flagged as potentially containing material
      non-public information (MNPI) about the target company. Processing must
      halt immediately and be escalated to the MNPI Compliance desk.
    classification: vetoed
    trigger_condition: >
      An input data source is flagged as potentially containing material
      non-public information (MNPI) about the target company, or originates
      from a deal room.
    condition_hint: data_source.mnpi_flag == true OR data_source.origin == "deal_room"
    escalation_contact: compliance-mnpi-desk@bank.example.com

  - id: target-on-restricted-list
    name: Target on Restricted or Watch List
    description: >
      The target company appears on the firm's restricted or watch list,
      indicating an active deal or conflict of interest. Processing must
      halt immediately and be escalated to the Conflicts Office.
    classification: vetoed
    trigger_condition: >
      The target company matches an entry on the firm's restricted or watch list.
    condition_hint: restricted_list_check.match == true
    escalation_contact: conflicts-office@bank.example.com

  - id: data-source-not-approved
    name: Unapproved Data Source
    description: >
      The agent has attempted to retrieve data from a vendor or source not on the
      approved data vendor list. Processing must halt and the IB Data Governance
      team must be notified.
    classification: vetoed
    trigger_condition: >
      Agent attempts to retrieve data from a vendor or source not present on the
      approved data vendor list.
    escalation_contact: ib-data-governance@bank.example.com

  # --- needs_approval: explicit human sign-off required before agent continues ---

  - id: restricted-list-cleared
    name: Restricted List Check Complete
    description: >
      Compliance confirms the target company is not on the restricted or watch list
      before any data retrieval or modelling begins.
    classification: needs_approval
    who_reviews: Compliance — Conflicts Office
    sla_hours: 2

  - id: valuation-senior-review
    name: Senior Banker Valuation Review
    description: >
      Senior banker reviews the agent's draft valuation output, including
      methodology, comparable selection, and DCF assumptions, and provides
      explicit sign-off before any client use.
    classification: needs_approval
    who_reviews: VP or MD — Investment Banking Coverage
    sla_hours: 24

  - id: external-sharing-approval
    name: External Distribution Sign-off
    description: >
      Coverage MD explicitly approves sharing the valuation model or summary
      with any external party.
    classification: needs_approval
    who_reviews: Coverage Managing Director
    sla_hours: 4

  - id: private-company-target
    name: Private Company — Enhanced Data Governance Review
    description: >
      Private company valuations rely on non-public financial data subject
      to NDA. Legal and compliance must confirm data usage is permissible
      before modelling proceeds.
    classification: needs_approval
    trigger_condition: Target company is not publicly listed.
    who_reviews: Legal Counsel + Compliance
    sla_hours: 48

  # --- review: human reviews and can flag issues before agent continues ---

  - id: data-anomaly-flagged
    name: Financial Data Anomaly Review
    description: >
      Analyst must acknowledge and document the anomaly before the model
      proceeds. Agent output must note the anomaly in the final report.
    classification: review
    trigger_condition: >
      Agent flags a material inconsistency or anomaly in source financials
      (e.g. restatement, non-recurring items exceeding 10% of EBITDA).
    who_reviews: Analyst or Associate — Investment Banking Coverage
    sla_hours: 4

workflow:
  steps:
    - id: restricted-list-check
      activity: restricted-list-check
      control_point: restricted-list-cleared

    - id: log-list-check
      activity: audit-log

    - id: retrieve-public-filings
      activity: retrieve-public-filings

    - id: log-filings-retrieved
      activity: audit-log

    - id: pull-market-data
      activity: pull-market-data

    - id: log-market-data-retrieved
      activity: audit-log

    - id: calculate-trading-multiples
      activity: calculate-trading-multiples

    - id: log-multiples-calculated
      activity: audit-log

    - id: build-dcf-inputs
      activity: build-dcf-inputs

    - id: log-dcf-built
      activity: audit-log

    - id: construct-lbo-skeleton
      activity: construct-lbo-skeleton

    - id: log-lbo-constructed
      activity: audit-log

    - id: flag-data-anomalies
      activity: flag-data-anomalies

    - id: generate-valuation-report
      activity: generate-valuation-report
      control_point: valuation-senior-review

    - id: log-report-generated
      activity: audit-log

    - id: deliver-model
      activity: deliver-model
      control_point: external-sharing-approval

    - id: log-delivery
      activity: audit-log

helper_skills:
  - id: shared/audit-logging
    purpose: >
      Records every data source retrieved, model input used, and workflow
      transition to the audit trail, satisfying FCA MAR and MiFID II
      record-keeping obligations.
    required: true
  - id: shared/checkpoint-gate
    purpose: >
      Enforces restricted-list clearance, senior banker review, and Coverage MD
      external-sharing approval; halts unconditionally on MNPI or restricted-list
      veto triggers.
    required: true
  - id: shared/validate-activity
    purpose: >
      Verifies every proposed agent action against the approved_activities
      allowlist before execution, enforcing scope boundaries at runtime.
    required: true
